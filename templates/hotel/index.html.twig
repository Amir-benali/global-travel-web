{% extends 'base.html.twig' %}

{% block title %}Hotel{% endblock %}

{% block body %}
    <div class="mx-auto max-w-7xl">
        <!-- Sub Navigation -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="flex items-center justify-between p-4">
                <div class="flex space-x-4">
                    <a href="#" class="px-4 py-2 text-blue-600 font-medium border-b-2 border-blue-600">All Hotels</a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Search Input -->
                    <input type="text" id="hotelSearch" placeholder="Search by hotel name..." class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600" />
                    <a href="{{ path('app_hotel_create') }}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="ri-add-line mr-1"></i>
                        ADD HOTEL
                    </a>
                    <a href="{{ path('app_hotel_list_pdf') }}" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="ri-file-pdf-line mr-1"></i>
                        Download PDF
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Hotel Grid -->
        <div id="hotelGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% if hotels|length > 0 %}
                {% for hotel in hotels %}
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <img src="https://haystack-dryers.com/admin/resources/hotel-placeholder-1-w1920.jpg" alt="{{ hotel.nomH|e }}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <!-- Hotel Name with Icon -->
                        <h3 class="text-lg font-medium text-gray-900 mb-2 flex items-center">
                            <i class="ri-hotel-line text-blue-600 mr-2"></i>
                            {{ hotel.nomH|e }}
                        </h3>
                        
                        <div class="grid grid-cols-2 gap-2 mb-4">
                            <div class="flex items-center">
                                <i class="ri-map-pin-line text-blue-600 mr-2"></i>
                                <span class="text-sm text-gray-600">{{ hotel.adresseH|e }}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="ri-earth-line text-blue-600 mr-2"></i>
                                <span class="text-sm text-gray-600">{{ hotel.villeH|e }}, {{ hotel.paysH|e }}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="ri-star-fill text-yellow-500 mr-2"></i>
                                <span class="text-sm text-gray-600">{{ hotel.categorieH }} stars</span>
                            </div>
                        </div>
                        
                        <!-- Services with Icon -->
                        <div class="mb-4 flex items-start">
                            <i class="ri-tools-line text-blue-600 mr-2"></i>
                            <p class="text-sm text-gray-600 line-clamp-2">{{ hotel.servicesH|e }}</p>
                        </div>
                        
                        <div class="flex space-x-2">
                            <!-- View Details -->
                            <a href="{{ path('app_hotel_details', { id: hotel.idHotelH }) }}" class="flex items-center justify-center w-10 h-10 bg-blue-500 hover:bg-blue-600 text-white rounded-full">
                                <i class="ri-eye-line"></i>
                            </a>
                            
                            <!-- Update -->
                            <a href="{{ path('app_hotel_update', { id: hotel.idHotelH }) }}" class="flex items-center justify-center w-10 h-10 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full">
                                <i class="ri-edit-line"></i>
                            </a>
                            
                            <!-- Delete -->
                            <form action="{{ path('app_hotel_delete', { id: hotel.idHotelH }) }}" method="post" class="flex items-center justify-center">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ hotel.idHotelH) }}">
                                <button type="submit" class="flex items-center justify-center w-10 h-10 bg-red-500 hover:bg-red-600 text-white rounded-full" onclick="return confirm('Are you sure you want to delete this hotel?');">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </form>
                            
                            <!-- Open Chambre -->
                            <a href="{{ path('app_chambre', { hotelId: hotel.idHotelH }) }}" class="flex items-center justify-center w-10 h-10 bg-green-500 hover:bg-green-600 text-white rounded-full">
                                <i class="ri-door-line"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="col-span-full text-center py-6">
                    <p class="text-gray-600">No hotels found.</p>
                </div>
            {% endif %}
        </div>

        <!-- Pagination -->
        <div id="pagination" class="mt-6 flex items-center justify-center">
            <div class="flex items-center space-x-2">
                {% if totalPages > 0 %}
                    {% if hasPreviousPage %}
                        <a href="#" data-page="{{ previousPage }}" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
                            Previous
                        </a>
                    {% else %}
                        <button class="px-4 py-2 bg-gray-300 text-gray-600 rounded-lg opacity-50" disabled>Previous</button>
                    {% endif %}

                    {% for page in 1..totalPages %}
                        <a href="#" data-page="{{ page }}"
                           class="px-4 py-2 {{ currentPage == page ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300' }} rounded-lg">
                            {{ page }}
                        </a>
                    {% endfor %}

                    {% if hasNextPage %}
                        <a href="#" data-page="{{ nextPage }}" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
                            Next
                        </a>
                    {% else %}
                        <button class="px-4 py-2 bg-gray-300 text-gray-600 rounded-lg opacity-50" disabled>Next</button>
                    {% endif %}
                {% else %}
                    <span class="text-gray-600">No pages available</span>
                {% endif %}
            </div>
        </div>
    </div>

    <style>
        #pagination {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
        }
        #pagination a, #pagination button {
            min-width: 40px;
            text-align: center;
        }
    </style>

    {% block javascripts %}
        {{ parent() }}
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {
                function loadHotels(searchTerm, page = 1) {
                    console.log('Loading hotels:', { search: searchTerm, page: page });
                    $.ajax({
                        url: '{{ path('app_hotel') }}',
                        method: 'GET',
                        data: { search: searchTerm, page: page },
                        success: function(response) {
                            console.log('AJAX response:', response);
                            var hotels = response.hotels || [];
                            var $grid = $('#hotelGrid');
                            $grid.empty();

                            if (hotels.length > 0) {
                                hotels.forEach(function(hotel) {
                                    var hotelHtml = `
                                        <div class="bg-white rounded-lg shadow overflow-hidden">
                                            <img src="https://haystack-dryers.com/admin/resources/hotel-placeholder-1-w1920.jpg" alt="${hotel.nomH}" class="w-full h-48 object-cover">
                                            <div class="p-4">
                                                <h3 class="text-lg font-medium text-gray-900 mb-2 flex items-center">
                                                    <i class="ri-hotel-line text-blue-600 mr-2"></i>
                                                    ${hotel.nomH}
                                                </h3>
                                                <div class="grid grid-cols-2 gap-2 mb-4">
                                                    <div class="flex items-center">
                                                        <i class="ri-map-pin-line text-blue-600 mr-2"></i>
                                                        <span class="text-sm text-gray-600">${hotel.adresseH}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <i class="ri-earth-line text-blue-600 mr-2"></i>
                                                        <span class="text-sm text-gray-600">${hotel.villeH}, ${hotel.paysH}</span>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <i class="ri-star-fill text-yellow-500 mr-2"></i>
                                                        <span class="text-sm text-gray-600">${hotel.categorieH} stars</span>
                                                    </div>
                                                </div>
                                                <div class="mb-4 flex items-start">
                                                    <i class="ri-tools-line text-blue-600 mr-2"></i>
                                                    <p class="text-sm text-gray-600 line-clamp-2">${hotel.servicesH}</p>
                                                </div>
                                                <div class="flex space-x-2">
                                                    <a href="{{ path('app_hotel_details', { id: '__ID__' }) }}".replace('__ID__', hotel.idHotelH) class="flex items-center justify-center w-10 h-10 bg-blue-500 hover:bg-blue-600 text-white rounded-full">
                                                        <i class="ri-eye-line"></i>
                                                    </a>
                                                    <a href="{{ path('app_hotel_update', { id: '__ID__' }) }}".replace('__ID__', hotel.idHotelH) class="flex items-center justify-center w-10 h-10 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full">
                                                        <i class="ri-edit-line"></i>
                                                    </a>
                                                    <form action="{{ path('app_hotel_delete', { id: '__ID__' }) }}".replace('__ID__', hotel.idHotelH) method="post" class="flex items-center justify-center">
                                                        <input type="hidden" name="_token" value="${hotel.csrf_token}">
                                                        <button type="submit" class="flex items-center justify-center w-10 h-10 bg-red-500 hover:bg-red-600 text-white rounded-full" onclick="return confirm('Are you sure you want to delete this hotel?');">
                                                            <i class="ri-delete-bin-line"></i>
                                                        </button>
                                                    </form>
                                                    <a href="{{ path('app_chambre', { hotelId: '__ID__' }) }}".replace('__ID__', hotel.idHotelH) class="flex items-center justify-center w-10 h-10 bg-green-500 hover:bg-green-600 text-white rounded-full">
                                                        <i class="ri-door-line"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                    $grid.append(hotelHtml);
                                });
                            } else {
                                $grid.html('<div class="col-span-full text-center py-6"><p class="text-gray-600">No hotels found matching your search.</p></div>');
                            }

                            // Update Pagination
                            var $pagination = $('#pagination .flex');
                            $pagination.empty();
                            console.log('Updating pagination:', { totalPages: response.totalPages, currentPage: response.currentPage });
                            if (response.totalPages > 0) {
                                // Previous Button
                                if (response.currentPage > 1) {
                                    $pagination.append(`<a href="#" data-page="${response.currentPage - 1}" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">Previous</a>`);
                                } else {
                                    $pagination.append(`<button class="px-4 py-2 bg-gray-300 text-gray-600 rounded-lg opacity-50" disabled>Previous</button>`);
                                }

                                // Numbered Page Buttons
                                for (var i = 1; i <= response.totalPages; i++) {
                                    $pagination.append(`<a href="#" data-page="${i}" class="px-4 py-2 ${i === response.currentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'} rounded-lg">${i}</a>`);
                                }

                                // Next Button
                                if (response.currentPage < response.totalPages) {
                                    $pagination.append(`<a href="#" data-page="${response.currentPage + 1}" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">Next</a>`);
                                } else {
                                    $pagination.append(`<button class="px-4 py-2 bg-gray-300 text-gray-600 rounded-lg opacity-50" disabled>Next</button>`);
                                }
                            } else {
                                $pagination.append(`<span class="text-gray-600">No pages available</span>`);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('AJAX error:', status, error);
                            $('#hotelGrid').html('<div class="col-span-full text-center py-6"><p class="text-red-600">Error loading hotels. Please try again.</p></div>');
                        }
                    });
                }

                // Real-time search
                let timeout;
                $('#hotelSearch').on('input', function() {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => loadHotels($(this).val()), 300);
                });

                // Pagination click handler
                $(document).on('click', '#pagination a[data-page]', function(e) {
                    e.preventDefault();
                    console.log('Pagination clicked:', $(this).data('page'));
                    loadHotels($('#hotelSearch').val(), $(this).data('page'));
                });

                // Initial load
                loadHotels('');
            });
        </script>
    {% endblock %}
{% endblock %}